# Blender to Godot (BTG) Pipeline
A simple pipeline for Godot class and variable assignments from within Blender.

## Installation
* Download the latest BTG release and extract the zip
* Place `btg_entity_importer/` in the `addons/` folder of your Godot project
* In Blender, go to `Edit > Preferences > Add-ons`
  * Select the dropdown on the top right and click "Install from Disk..."
  * Navigate to `btg_entity_exporter.zip` and click "Install from Disk"

## Overview
The pipeline uses two JSON files:
* `entity_template.json`: A file (written by you) that tells Blender what classes and variables you want to expose
* `entity_definition.json`: A file generated by the Blender add-on and used in the importer to assign your Godot classes and variables to your `.blend` or your exported `.glb/.gltf` model

The workflow is typically:
* Write the `entity_template.json` for your Godot project, updating it when you want to expose new classes/variables
  * Updates will need to be re-imported into Blender
* Once you're finished in Blender, export your model and hit the `Write BTG import JSON` button
  * Note: exporting your model does not write `entity_definition.json`, exporting and importing the entity information is a separate process
* In Godot, add the path of `entity_definition.json` to your `.blend` or `.glb/.gltf` model import settings and re-import

## Writing the Entity Template JSON
<!-- In the entity template, Godot classes can be exposed to Blender by entering their class name as a key. Every entity definition has a "uid" field (this can also be the path to the .gd or .tscn file) and a "variables" field. Within the "variables" field, variables can be defined with a Godot type, default value, and (optional) description. Enums also require an "options" field to be defined. "uid" can be skipped for built-in Godot classes. -->

#### `entity_template.json` Format
```
{
    "GodotClassName": {
        "uid": "uid://someUID",
        "variables": {
            "var_name": {
                "type": "SomeType",
                "default": default,
                "description": "Description string",
                "options": ["String option 1", "String option 2", ...]
            },
            ...
        }
    },
    ...
}
```
* GodotClassName: The name of the class in Godot, matching case (usually pascal case)
* uid: The UID of the file where the class is defined
  * This can be skipped for built-in Godot classes
  * This can also be the path to a .tscn file (see the demo scene for more information)
* variables: This is where all variables you want to expose to Blender will be defined
  * You do not need to expose all variables in a class to Blender
* type: A string of the Godot variable type
* default: A JSON primitive that will be converted to "type"
  * see "Things to Note" for more information
* description: A description of the variable
  * This is currently unused and can be omitted
* options: For enums, The strings for the enum
  * This should be omitted for everything but enum-type variables

#### Example `entity_template.json`
```
{
    "BTGExampleClass0": {
        "uid": "uid://cslerxu3gbk31",
        "variables": {
            "string_example": {
                "type": "String",
                "default": "string example",
                "description": "",
                "options": []
            },
            "int_example": {
                "type": "int",
                "default": 1,
                "description": "",
                "options": []
            },
            "vector_example": {
                "type": "Vector3",
                "default": [1, 2, 3],
                "description": "",
                "options": []
            },
            "enum_example": {
                "type": "enum",
                "default": "OPTION_1",
                "description": "",
                "options": ["OPTION_1", "OPTION_2", "OPTION_3"]
            }
        }
    },
    "Area3D": {
        "variables": {
            "angular_damp": {
                "type": "float",
                "default": 0.1,
                "description": "The rate at which objects stop spinning in this area.",
            }
        }
    }
}
```

#### Custom Variable Handling
You can implement custom variable handling by passing in the name of a function as `type` in your entity template. This function must take as string input and return a value. See the demo scene for more information.


#### Things to Note
* Every parameter in `entity_template.json` other than `default` is a string
* `default` represents your Godot variable type. Supported Godot types are:
  * String, ex: `"var_name": ["String", "", "desc"]`
  * int, ex: `"var_name": ["int", 0, "desc"]`
  * bool, ex: `"var_name": ["bool", false, "desc"]`
  * float, ex: `"var_name": ["float", 0.0, "desc"]`
  * Vector3, ex: `"var_name": ["Vector3", [0.0, 0.0, 0.0], "desc"]`
  * Vector3i, ex: `"var_name": ["Vector3i", [0, 0, 0], "desc"]`
  * Vector2, ex: `"var_name": ["Vector2", [0.0, 0.0], "desc"]`
  * Vector2i, ex: `"var_name": ["Vector2i", [0, 0], "desc"]`
* The above values are handled automatically by the importer. To Add new variable types or to handle importing a specific variable yourself, use the name of a member function as `type`
* The Blender extension has a catch-all for unknown entries in the `type` field. If you enter a value that is not one of the above, it will be interpreted as a string.

## BTG Import JSON
Once you have written your `entity_template.json`, imported it into your Blender project, and assigned your classes, you are ready to write the import JSON.

A Generated `entity_definition.json` may look something like:
```
{
    "Cube": {
        "class": "BTGExampleClass0",
        "uid": "uid://cslerxu3gbk31",
        "variables": {
            "string_example": {
                "type": "String",
                "value": "auto-import test 6"
            },
            "int_example": {
                "type": "int",
                "value": 4
            },
            "vector_example": {
                "type": "Vector3",
                "value": "(1.0, 2.0, 3.0)"
            },
            "enum_example": {
                "type": "enum",
                "value": "OPTION_2"
            }
        }
    },
    "Icosphere": {
        "class": "Area3D",
        "variables": {
            "angular_damp": {
                "type": "float",
                "value": "0.82",
            }
        }
    }
}
```
#### Things to Note:
TODO

## Useful Tools and Add-ons
TODO

# TODO
* Finish "BTG Import JSON" section
  * Step by step on how to add the exported JSON and reimport
  * Add info about how to setup importing and how automatic importing can work with .blend files
* add "useful tools" section with links to complimentary addons
  * That one reddit post
  * the Blender addons that I use
  * link to Godot's import tag page
  * Something about extending mesh-instance or using empties to prevent meshes from disappearing
    * define your own mesh variable!
  * linking can be very useful (file>link and then override twice)
    * But be careful because you will need to re-save and export every blend you link to if you update the source one
* revise gdscript code
* finish both demo scenes
* Note downsides of using this program
  * Biggest being there is no automatic way to convert to a Godot primitive shape
  * alt+d duplication doesn't work right now
  * this addon does not work well with the asset lib